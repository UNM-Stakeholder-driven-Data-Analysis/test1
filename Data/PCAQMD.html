<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.15">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Untitled</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="PCAQMD_files/libs/clipboard/clipboard.min.js"></script>
<script src="PCAQMD_files/libs/quarto-html/quarto.js"></script>
<script src="PCAQMD_files/libs/quarto-html/popper.min.js"></script>
<script src="PCAQMD_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="PCAQMD_files/libs/quarto-html/anchor.min.js"></script>
<link href="PCAQMD_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PCAQMD_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="PCAQMD_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="PCAQMD_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="PCAQMD_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Untitled</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="shiny-documents" class="level2">
<h2 class="anchored" data-anchor-id="shiny-documents">Shiny Documents</h2>
<p>This Quarto document is made interactive using Shiny. Interactive documents allow readers to modify parameters and see the results immediately. Learn more about Shiny interactive documents at <a href="https://quarto.org/docs/interactive/shiny/" class="uri">https://quarto.org/docs/interactive/shiny/</a>.</p>
</section>
<section id="inputs-and-outputs" class="level2">
<h2 class="anchored" data-anchor-id="inputs-and-outputs">Inputs and Outputs</h2>
<p>You can embed Shiny inputs and outputs in your document. Outputs are automatically updated whenever inputs change. This demonstrates how a standard R plot can be made interactive:</p>
<div class="cell">
<div class="cell-output-display">
<div class="form-group shiny-input-container">
<label class="control-label" id="bins-label" for="bins">Number of bins:</label>
<input class="js-range-slider" id="bins" data-skin="shiny" data-min="1" data-max="50" data-from="30" data-step="1" data-grid="true" data-grid-num="9.8" data-grid-snap="false" data-prettify-separator="," data-prettify-enabled="true" data-keyboard="true" data-data-type="number">
</div>
</div>
<div class="cell-output-display">
<div id="distPlot" class="shiny-plot-output" style="width:100%;height:400px;"></div>
</div>
</div>
<div class="cell" data-context="server">

</div>
<section id="read-me" class="level4">
<h4 class="anchored" data-anchor-id="read-me">read me</h4>
</section>
</section>
<section id="the-purpose-of-this-script-is-to-demonstrate-calculating-and-exploring-a-pca-on-a-stream-chemistry-dataset" class="level1">
<h1>The purpose of this script is to demonstrate calculating and exploring a PCA on a stream chemistry dataset</h1>
</section>
<section id="steps" class="level1">
<h1>Steps:</h1>
</section>
<section id="check-that-data-meets-assumptions-of-pcas" class="level1">
<h1>1. Check that data meets assumptions of PCAs</h1>
</section>
<section id="compute-pca" class="level1">
<h1>2. Compute PCA</h1>
</section>
<section id="explore-pca" class="level1">
<h1>3. Explore PCA</h1>
</section>
<section id="plot-pca" class="level1">
<h1>4. Plot PCA</h1>
</section>
<section id="check-that-results-meet-assumptions---outliers" class="level1">
<h1>5. Check that results meet assumptions - outliers</h1>
</section>
<section id="actually-1-decide-which-axes-to-retain" class="level1">
<h1>6. (actually 1!) Decide which axes to retain</h1>
</section>
<section id="interpret-axes" class="level1">
<h1>7. Interpret axes</h1>
</section>
<section id="extract-scores-for-further-analysis-if-applicable" class="level1">
<h1>8. Extract scores for further analysis (if applicable)</h1>
<section id="libraries" class="level4">
<h4 class="anchored" data-anchor-id="libraries">libraries</h4>
<p>library(tidyverse) library(ade4) library(psych) library(FactoMineR) library(factoextra) library(corrplot)</p>
</section>
<section id="load-and-tidy-data" class="level4">
<h4 class="anchored" data-anchor-id="load-and-tidy-data">load and tidy data</h4>
<p>setwd(“C:/Users/marag.DESKTOP-NEKBNJE/OneDrive/Desktop/Stakeholder data analysis/test1/Data”) dat = read.csv(“anionsf.csv”) dat &lt;- read.csv(“anionsf.csv”, na.strings = c(“.”)) str(dat) #dat&lt;- na.omit(dat)</p>
</section>
</section>
<section id="reduce-to-3-sites-for-the-purposes-of-most-of-this-tutorial" class="level1">
<h1>reduce to 3 sites for the purposes of most of this tutorial</h1>
<p>#dat = dat[dat<span class="math inline">\(SiteName =="Savannah"| dat\)</span>Site.Name ==“Calabacillas”| dat$Site.Name ==“Minnow”,]</p>
</section>
<section id="check-data-classes" class="level1">
<h1>check data classes</h1>
<p>str(dat)</p>
</section>
<section id="format-datetime" class="level1">
<h1>format date/time</h1>
</section>
<section id="format-datetime-this-code-worked-well-to-format-date" class="level1">
<h1>format date/time: this code worked well to format date</h1>
<p>dat<span class="math inline">\(DateF = as.POSIXct(dat\)</span>Date, format=“%m/%d/%Y %H:%M”, tz=“US/Mountain”) str(dat) #dat<span class="math inline">\(datetime_NM = as.POSIXct(dat\)</span>Sample_DateTime, format=“%m/%d/%y %H:%M”, tz=“US/Mountain”)</p>
</section>
<section id="convert-characters-that-should-be-factors-categories-to-factors" class="level1">
<h1>convert characters that should be factors (categories) to factors</h1>
<p>dat<span class="math inline">\(SiteName = as.factor(dat\)</span>SiteName) dat<span class="math inline">\(Samplingtype = as.factor(dat\)</span>Samplingtype) #dat<span class="math inline">\(Is_Nondetect = as.factor(dat\)</span>Is_Nondetect)</p>
</section>
<section id="convert-water-quality-data-to-numeric" class="level1">
<h1>convert water quality data to numeric</h1>
<p>dat<span class="math inline">\(Bromide = as.numeric(dat\)</span>Bromide) dat<span class="math inline">\(Fluoride = as.numeric(dat\)</span>Fluoride) dat<span class="math inline">\(NH4N = as.numeric(dat\)</span>NH4N ) dat<span class="math inline">\(Sulfate = as.numeric(dat\)</span>Sulfate) dat<span class="math inline">\(Chloride = as.numeric(dat\)</span>Chloride) dat<span class="math inline">\(PhosphateP = as.numeric(dat\)</span>PhosphateP) dat<span class="math inline">\(Turbidity = as.numeric(dat\)</span>Turbidity) dat<span class="math inline">\(condTemp = as.numeric(dat\)</span>condTemp) dat<span class="math inline">\(DO = as.numeric(dat\)</span>DO)</p>
<p>#datF &lt;- # dat %&gt;% subset(dat, select = -c(Year,Month,Day,Sampling.type, Do,Fluoride,Nitrite,Bromide,NitrateN,PhosphateP,NH4.N,DateF, Timesampling, Timeofsitearrival, Date, Datecombined ))</p>
</section>
<section id="only-keep-select-columns" class="level1">
<h1>only keep select columns</h1>
<p>#datS &lt;- # dat %&gt;% subset(dat, select = -c(“Airtemp”, “Turbidity”, “DoPercent”, “DOTemp”, “Conductivity”, “condTemp” ,“pH1” , “Chloride”, “Sulfate”))</p>
<p>datS &lt;- select(dat, c(“SiteName”,“Airtemp”, “DoPercent”, “DOTemp”, “Conductivity”, “condTemp” ,“pH1” , “Chloride”, “Sulfate”)) str(datS) #</p>
<p>#dat = dat %&gt;% # rownames_to_column(“Site.Name”) %&gt;% # separate(Site, c(“Year”,“Day”,“Month”,“Sampling.type”,“Time”,“DO”,“Fluoride”,“Nitrite”,“Bromide”,“NitrateN”, “PhosphateP”, “NH4.N”, “DateF”), remove = F) # turn columns and variables to numeric and factor</p>
<p>#exclude variables and work on non zero inflated variables (Will have ~ 9 variables not zero inflated)</p>
<section id="check-assumption" class="level4">
<h4 class="anchored" data-anchor-id="check-assumption">1. check assumption</h4>
<p>datS&lt;- na.omit(datS)</p>
<p>pairs.panels(datS[,2:9], scale=TRUE)</p>
<p>range(datS<span class="math inline">\(Sulfate) range(datS\)</span>Chloride) range(datS$condTemp)</p>
</section>
<section id="compute-pca-1" class="level4">
<h4 class="anchored" data-anchor-id="compute-pca-1">2. compute PCA</h4>
<p>d2 = datS[,2:9] rownames(d2) = datS$SiteName</p>
<p>pca = prcomp(d2, scale = T)</p>
<p>summary(pca)</p>
<p>str(pca)</p>
</section>
</section>
<section id="the-value-of-each-observation-on-each-pc-axis" class="level1">
<h1>The value of each observation on each PC axis</h1>
</section>
<section id="also-known-as-scores" class="level1">
<h1>also known as “scores”</h1>
<p>pca$x</p>
<section id="explore-pca-1" class="level4">
<h4 class="anchored" data-anchor-id="explore-pca-1">3. explore PCA</h4>
</section>
<section id="view-eigenvalues" class="level3">
<h3 class="anchored" data-anchor-id="view-eigenvalues">view eigenvalues:</h3>
<p>get_eigenvalue(pca) fviz_eig(pca, addlabels = TRUE, choice = c(“eigenvalue”)) # as scree plot with eigenvalues fviz_eig(pca, addlabels = TRUE, choice = c(“variance”)) # as scree plot with % variance explained</p>
<section id="plot-pca-1" class="level4">
<h4 class="anchored" data-anchor-id="plot-pca-1">4. plot pca</h4>
</section>
</section>
</section>
<section id="biplot-of-sites-variables" class="level1">
<h1>biplot of sites + variables</h1>
<p>pca.p.1.2 = fviz_pca_biplot(pca, axes = c(1, 2), # specify axes repel = TRUE, col.var = “blue”, # Variables color col.ind = “#696969” # Individuals color )</p>
<p>pca.p.1.3 = fviz_pca_biplot(pca, axes = c(1, 3), # specify axes repel = TRUE, col.var = “#2E9FDF”, # Variables color col.ind = “#696969” # Individuals color )</p>
<p>pca.p.1.4 = fviz_pca_biplot(pca, axes = c(1, 4), # specify axes repel = TRUE, col.var = “#2E9FDF”, # Variables color col.ind = “#696969” # Individuals color )</p>
</section>
<section id="plot-of-sites-95-ci-groupings" class="level1">
<h1>plot of sites + 95% CI groupings</h1>
<p>fviz_pca_ind(pca, habillage=datS$SiteName, axes = c(1, 2), label=“none”, addEllipses=TRUE, ellipse.level=0.95)</p>
<p>fviz_pca_ind(pca, habillage=datS$SiteName, axes = c(1, 3), label=“none”, addEllipses=TRUE, ellipse.level=0.95)</p>
<p>fviz_pca_ind(pca, habillage=datS$SiteName, axes = c(2, 3), label=“none”, addEllipses=TRUE, ellipse.level=0.95)</p>
<p>fviz_pca_ind(pca, habillage=datS$site_group, axes = c(1, 4), label=“none”, addEllipses=TRUE, ellipse.level=0.95)</p>
<p>fviz_pca_ind(pca, habillage=datS$site_group, axes = c(1, 5), label=“none”, addEllipses=TRUE, ellipse.level=0.95)</p>
<p>fviz_pca_ind(pca, habillage=datS$site_group, axes = c(1, 6), label=“none”, addEllipses=TRUE, ellipse.level=0.95)</p>
<section id="check-weight-of-outliers" class="level4">
<h4 class="anchored" data-anchor-id="check-weight-of-outliers">5. check weight of outliers</h4>
</section>
</section>
<section id="specify-outliers" class="level1">
<h1>specify outliers</h1>
<p>outliers = c(“au_2”)</p>
</section>
<section id="remove-outliers" class="level1">
<h1>remove outliers</h1>
<p>d3 = d2[!(row.names(d2) %in% outliers),]</p>
</section>
<section id="re-compute-pca" class="level1">
<h1>re-compute pca</h1>
<p>pca2 = prcomp(d3, scale = T)</p>
</section>
<section id="re-plot-pca" class="level1">
<h1>re-plot pca</h1>
<p>fviz_pca_biplot(pca2, axes = c(1, 2), # specify axes repel = TRUE, col.var = “blue”, # Variables color col.ind = “#696969” # Individuals color ) # looks similar, so can use unaltered d #</p>
<section id="actually-1-decide-which-axes-to-retain-1" class="level4">
<h4 class="anchored" data-anchor-id="actually-1-decide-which-axes-to-retain-1">6. (actually 1!) decide which axes to retain</h4>
</section>
<section id="you-should-choose-which-rule-to-follow-a-priori" class="level3">
<h3 class="anchored" data-anchor-id="you-should-choose-which-rule-to-follow-a-priori">YOU SHOULD CHOOSE WHICH RULE TO FOLLOW A-PRIORI!!!</h3>
</section>
</section>
<section id="possible-a-priori-rules" class="level1">
<h1>Possible a priori rules:</h1>
</section>
<section id="a-1-eigenvalue-rule-values-of-1-indicate-that-those-axes-account-for-more-variance-than-any-one-original-variable-standardized-data-only.-rule-is-to-retain-all-axes-with-an-eigenvalue-of-1-or-more" class="level1">
<h1>a) 1 eigenvalue rule: values of 1 indicate that those axes account for more variance than any one original variable (standardized data only). Rule is to retain all axes with an eigenvalue of 1 or more</h1>
</section>
<section id="b-total-variance-rule-retain-all-axes-for-which-variance-explained-sums-to-x-e.g.-90" class="level1">
<h1>b) % total variance rule: retain all axes for which % variance explained sums to &gt; X% (e.g., 90%)</h1>
</section>
<section id="c-variance-rule-retain-all-axes-for-which-at-least-x-variance-is-explained-e.g.-10" class="level1">
<h1>c) % variance rule: retain all axes for which at least X% variance is explained (e.g., 10%)</h1>
</section>
<section id="d-broken-stick-rule-retain-all-axes-before-break-in-scree-plot" class="level1">
<h1>d) Broken stick rule: retain all axes before break in scree plot</h1>
<p>fviz_eig(pca, addlabels = TRUE, choice = c(“eigenvalue”)) # as scree plot with eigenvalues fviz_eig(pca, addlabels = TRUE, choice = c(“variance”)) # as scree plot with % variance explained</p>
<section id="interpret-axes-1" class="level4">
<h4 class="anchored" data-anchor-id="interpret-axes-1">7. interpret axes</h4>
</section>
</section>
<section id="extract-results" class="level1">
<h1>extract results</h1>
<p>var = get_pca_var(pca)</p>
</section>
<section id="extract-contribution-of-each-variable-to-each-pc-unit" class="level1">
<h1>extract contribution of each variable to each PC (unit = %)</h1>
<p>contrib = (var$contrib) contrib</p>
</section>
<section id="plot-contribution" class="level1">
<h1>plot contribution</h1>
<p>corrplot(contrib, is.corr = F)</p>
</section>
<section id="axis-1" class="level1">
<h1>axis 1:</h1>
</section>
<section id="axis-2" class="level1">
<h1>axis 2:</h1>
</section>
<section id="axis-3" class="level1">
<h1>axis 3:</h1>
<section id="extract-scores" class="level4">
<h4 class="anchored" data-anchor-id="extract-scores">8. extract scores</h4>
<p>pca.scrs = as.data.frame(pca$x[,1:3]) pca.scrs</p>
<p>
<script type="application/shiny-prerendered" data-context="server">
output$distPlot <- renderPlot({
   x <- faithful[, 2]  # Old Faithful Geyser data
   bins <- seq(min(x), max(x), length.out = input$bins + 1)
   hist(x, breaks = bins, col = 'darkgray', border = 'white',
        xlab = 'Waiting time to next eruption (in mins)',
        main = 'Histogram of waiting times')
})
</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(function(q, nm, val) {
    # Infer name, if possible
    if (nm == "") {
      tryCatch({
        nm <- rlang::as_name(q)
      }, error = function(e) {
        code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
        stop("ojs_define() could not create a name for the argument: ", code)
      })
    }
    .session$output[[nm]] <- val
    outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
    .session$sendCustomMessage("ojs-export", list(name = nm))
    NULL
  }, quos, nm, vars, SIMPLIFY = FALSE, USE.NAMES = FALSE)
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-javascript"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/ion.rangeSlider.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.7.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["strftime"]},{"type":"character","attributes":{},"value":["0.9.2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/strftime"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["strftime-min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.7.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ionrangeslider-css"]},{"type":"character","attributes":{},"value":["2.3.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["www/shared/ionrangeslider"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/ion.rangeSlider.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["shiny"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["1.7.2"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->

<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]}},"value":[{"type":"character","attributes":{},"value":["base","bslib","cli","compiler","datasets","digest","ellipsis","evaluate","fastmap","graphics","grDevices","htmltools","htmlwidgets","httpuv","jquerylib","jsonlite","knitr","later","lifecycle","magrittr","methods","mime","promises","R6","Rcpp","rlang","rmarkdown","rstudioapi","sass","shiny","stats","stringi","stringr","tools","utils","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["4.2.0","0.3.1","3.3.0","4.2.0","4.2.0","0.6.29","0.3.2","0.15","1.1.0","4.2.0","4.2.0","0.5.4","1.6.1","1.6.5","0.1.4","1.8.0","1.39","1.3.0","1.0.1","2.0.3","4.2.0","0.12","1.2.0.1","2.5.1","1.0.8.3","1.0.4","2.14","0.13","0.4.1","1.7.2","4.2.0","1.7.6","1.4.0","4.2.0","4.2.0","0.31","1.8-4","2.3.5"]}]}]}
</script>
<!--/html_preserve-->
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>